# Экран 5.2: Theme and Icon Screen (Тема и иконка)

## Обзор

Theme and Icon Screen предназначен для настройки темы приложения и выбора иконки приложения. Экран позволяет пользователю выбрать между светлой, темной и системной темой, а также выбрать одну из доступных иконок приложения.

## Назначение

Настройка темы приложения и выбор иконки приложения с сохранением настроек в DataStore.

## Компоненты

1. **Заголовок экрана** — "Тема и иконка"
2. **Секция "Тема приложения"**
   - Заголовок: "Тема"
   - Выбор из опций:
     - "Светлая"
     - "Тёмная"
     - "Системная"
   - Радиокнопки или Dropdown
3. **Секция "Иконка приложения"**
   - Заголовок: "Иконка"
   - Сетка с иконками (GridView)
   - Каждая иконка:
     - Превью иконки (65x65dp)
     - Галочка на выбранной иконке
   - При клике — установка иконки (если поддерживается системой)

## Навигация

- Кнопка "Назад" → Screen 5.1 (More Screen)

## Зависимости от других этапов

- ⚠️ **Требуется Экран 5.1**: More Screen — должен быть реализован для навигации к ThemeIcon Screen
- ⚠️ **Требуется DataStore**: DataStore для хранения настроек должен быть настроен

---

## Подробный план реализации по TDD

### Шаг 1: Структура и навигация

#### 1.1. Добавление маршрута

**Задачи:**
1. Добавить маршрут `ThemeIcon` в `navigation/Screen.kt`
2. Создать отдельный файл `ThemeIconScreen.kt` в `ui/screen/`
3. Реализовать навигацию к экрану из Screen 5.1 (More Screen)
4. Добавить кнопку "Назад" с навигацией к Screen 5.1

**Критерии готовности:**
- ✅ Маршрут добавлен
- ✅ Файл ThemeIconScreen.kt создан
- ✅ Навигация настроена

---

### Шаг 2: DataStore и хранение настроек

#### 2.1. Создание DataStore

**Задачи:**
1. Создать DataStore для хранения настроек приложения
2. Реализовать сохранение выбранной темы (светлая/тёмная/системная)
3. Реализовать сохранение выбранной иконки приложения
4. Написать unit-тесты для DataStore

**Структура:**
```kotlin
data class AppSettings(
    val theme: AppTheme = AppTheme.SYSTEM,
    val appIcon: AppIcon = AppIcon.DEFAULT
)

enum class AppTheme {
    LIGHT, DARK, SYSTEM
}

enum class AppIcon {
    DEFAULT, ICON_2, ICON_3, ICON_4, ICON_5
}
```

**Критерии готовности:**
- ✅ DataStore создан
- ✅ Сохранение настроек работает
- ✅ Unit-тесты написаны и проходят

---

### Шаг 3: ViewModel

#### 3.1. Создание ViewModel

**Задачи:**
1. Создать `ThemeIconViewModel` для управления состоянием настроек
2. Реализовать загрузку текущих настроек из DataStore
3. Реализовать обновление темы приложения
4. Реализовать обновление иконки приложения
5. Использовать `viewModelScope` для корутин
6. Написать unit-тесты для ViewModel

**Критерии готовности:**
- ✅ ViewModel создан
- ✅ Загрузка настроек работает
- ✅ Обновление настроек работает
- ✅ Unit-тесты написаны и проходят

---

### Шаг 4: Обновление темы приложения

#### 4.1. Расширение темы

**Задачи:**
1. Расширить `jetpackDaysTheme()` для поддержки выбора темы пользователем
2. Реализовать переключение между светлой, тёмной и системной темой
3. Обеспечить применение выбранной темы во всём приложении
4. Написать unit-тесты для темы

**Критерии готовности:**
- ✅ Тема расширена
- ✅ Переключение темы работает
- ✅ Применение темы работает во всём приложении
- ✅ Unit-тесты написаны и проходят

---

### Шаг 5: UI компоненты - Секция темы

#### 5.1. Реализация выбора темы

**Задачи:**
1. Создать раздел для выбора темы приложения
2. Реализовать радиокнопки или выпадающий список для выбора темы
3. Отобразить текущую выбранную тему
4. Написать UI тесты для выбора темы

**Критерии готовности:**
- ✅ Раздел темы создан
- ✅ Выбор темы работает
- ✅ Текущая тема отображается
- ✅ UI тесты написаны

---

### Шаг 6: UI компоненты - Секция иконки

#### 6.1. Реализация выбора иконки

**Задачи:**
1. Создать сетку для отображения доступных иконок (LazyVerticalGrid)
2. Реализовать превью иконок (65x65dp)
3. Реализовать визуальное выделение выбранной иконки (галочка)
4. Добавить обработчик клика для выбора иконки
5. Написать UI тесты для выбора иконки

**Критерии готовности:**
- ✅ Сетка иконок создана
- ✅ Превью иконок работает
- ✅ Выделение выбранной иконки работает
- ✅ UI тесты написаны

---

### Шаг 7: Функциональность изменения иконки

#### 7.1. Реализация изменения иконки

**Задачи:**
1. Реализовать функциональность изменения иконки приложения (если поддерживается системой Android)
2. Обработать случаи, когда изменение иконки не поддерживается
3. Написать unit-тесты для изменения иконки

**Критерии готовности:**
- ✅ Изменение иконки работает (если поддерживается)
- ✅ Обработка неподдерживаемых случаев реализована
- ✅ Unit-тесты написаны и проходят

---

### Шаг 8: Верстка компонентов

#### 8.1. Финальная верстка

**Задачи:**
1. Использовать вертикальный Column для основного макета
2. Добавить разделы с заголовками для темы и иконки
3. Обеспечить адекватное отображение элементов при изменении ориентации экрана
4. Применить корректные иконки из Material Icons
5. Применить тему приложения с поддержкой темного режима

**Критерии готовности:**
- ✅ Верстка выполнена
- ✅ Адаптивность обеспечена
- ✅ Тема применена

---

### Шаг 9: Локализация

**Задачи:**
1. Использовать готовые строковые ресурсы из `Localization_Plan.md`:
   - Заголовок экрана: `app_theme_and_icon`
   - Заголовки секций: `app_theme`, `app_icon`
   - Опции темы: `light`, `dark`, `system`
   - Названия иконок: `primary_icon`, `variant` (с параметром), `selected`, `not_selected`
2. Поддержка русского и английского языков (уже реализована в `Localization_Plan.md`)

**Критерии готовности:**
- ✅ Используются готовые строковые ресурсы
- ✅ Локализация работает корректно

**Примечание:** План локализации готов в документе `Localization_Plan.md`. Все строки определены и готовы к использованию.

---

### Шаг 10: Финальное тестирование

**Задачи:**
1. Проверить изменение темы приложения (unit + UI тесты)
2. Проверить сохранение выбранной темы (unit + UI тесты)
3. Проверить визуальное выделение выбранной иконки (UI тесты)
4. Проверить корректное отображение сетки иконок (UI тесты)
5. Проверить корректную навигацию назад (UI тесты)
6. Проверить применение темы во всём приложении (интеграционные тесты)

**Критерии готовности:**
- ✅ Все тесты проходят
- ✅ Все функции работают корректно

---

## Реализация (детали)

### UI компоненты
- Использовать вертикальный Column для основного макета
- Добавить разделы с заголовками для темы и иконки
- Добавить радиокнопки или выпадающий список для выбора темы
- Добавить сетку иконок с визуальным выделением выбранной
- Обеспечить адекватное отображение элементов при изменении ориентации экрана
- Использовать современные компоненты Material Design 3
- Применить тему приложения с поддержкой темного режима
- Применить корректные иконки из Material Icons

### Архитектура
- Использовать DataStore для хранения настроек
- Использовать Coroutines для асинхронных операций с DataStore
- Реализовать обработку ошибок и состояний загрузки
- Применить Clean Architecture (Data → Domain → Presentation)

---

## Тестирование

### Unit-тесты
- Тесты для DataStore (сохранение и загрузка настроек)
- Тесты для ThemeIconViewModel (логика управления настройками)
- Тесты для темы приложения (переключение между темами)

### Интеграционные тесты
- Тесты взаимодействия ViewModel с DataStore
- Тесты применения темы во всём приложении

### UI-тесты
- Проверить изменение темы приложения
- Проверить сохранение выбранной темы
- Проверить визуальное выделение выбранной иконки
- Проверить корректное отображение сетки иконок
- Проверить корректную навигацию назад

---

## Критерии завершения этапа

Этап считается завершенным, когда:

- ✅ Все компоненты созданы и работают
- ✅ Все unit-тесты написаны и проходят
- ✅ Все интеграционные тесты написаны и проходят
- ✅ Все UI-тесты написаны и проходят
- ✅ Код соответствует правилам проекта
- ✅ Линтеры не выдают ошибок
- ✅ Настройки сохраняются корректно
- ✅ Тема применяется корректно во всём приложении

---

## Блокируемые этапы

После завершения этого экрана можно приступать к:
- Нет блокируемых этапов — это финальный экран настроек

---

## Примечания

1. **Изменение иконки**: Изменение иконки приложения поддерживается только на Android 8.0 (API 26) и выше через Activity Aliases. На более старых версиях функция должна быть скрыта или отключена.

2. **Системная тема**: При выборе системной темы приложение должно следовать системным настройкам темы устройства.

3. **Сохранение настроек**: Все настройки должны сохраняться в DataStore и применяться при следующем запуске приложения.

4. **Тестирование**: Все компоненты должны быть покрыты тестами перед использованием в других этапах.

5. **Зависимости**: Реализация зависит от завершения Экрана 5.1 (More Screen) и настройки DataStore.
