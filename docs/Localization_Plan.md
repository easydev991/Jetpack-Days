# План локализации для Android

## Обзор

Данный документ описывает реализацию локализации для Android-приложения на основе строк из iOS-приложения. Все строки определены в iOS-проекте (`Localizable.xcstrings`) и перенесены в Android-проект с сохранением идентичности переводов.

**Статус:** ✅ Локализация реализована и интегрирована в код (частично: шаги 1-5 выполнены, шаг 6 требует рефакторинга)

## Источник истины

**iOS-приложение** (`SwiftUI-Days/SupportingFiles/Localizable.xcstrings`) является источником истины для всех локализованных строк. Android-версия должна использовать идентичные переводы.

## Поддерживаемые языки

- **Русский (ru)** — основной язык
- **Английский (en)** — дополнительный язык

## Структура локализации в Android

### Файлы ресурсов

- `app/src/main/res/values/strings.xml` — строки по умолчанию (английский)
- `app/src/main/res/values-ru/strings.xml` — русские переводы

### Формат строк

Все строки должны быть определены в формате Android strings.xml:

```xml
<resources>
    <string name="string_key">String value</string>
</resources>
```

---

## Список локализованных строк

### Общие строки

#### Навигация и вкладки
- `events` — "Events" / "События"
- `more` — "More" / "Ещё"

#### Кнопки действий
- `add_item` — "Add Item" / "Добавить запись"
- `save` — "Save" / "Сохранить"
- `cancel` — "Cancel" / "Отмена"
- `close` — "Close" / "Закрыть"
- `edit` — "Edit" / "Изменить"
- `delete` — "Delete" / "Удалить"
- `ok` — "Ok" / "Ок"
- `done` — "Done" / "Готово"

#### Заголовки экранов
- `events` — "Events" / "События"
- `more` — "More" / "Ещё"
- `new_item` — "New Item" / "Новая запись"
- `edit_item` — "Edit Item" / "Изменить запись"
- `app_data` — "App data" / "Данные приложения"
- `app_theme_and_icon` — "App theme and Icon" / "Тема и иконка приложения"

---

### Экран Main Screen

#### Заголовки и описания
- `what_should_we_remember` — "What should we remember?" / "Что нужно запомнить?"
- `create_your_first_item` — "Create your first item" / "Сделайте вашу первую запись"

#### Сортировка
- `sort` — "Sort" / "Сортировка"
- `sort_order` — "Sort Order" / "Порядок сортировки"
- `old_first` — "Old first" / "Сначала старые"
- `new_first` — "New first" / "Сначала новые"

---

### Экран Item Screen (Просмотр записи)

#### Заголовки секций
- `title` — "Title" / "Название"
- `details` — "Details" / "Детали"
- `date` — "Date" / "Дата"
- `color_tag` — "Color tag" / "Цветовой тег"
- `display_format` — "Display format" / "Формат отображения"

#### Специальные значения
- `today` — "Today" / "Сегодня"

---

### Экран Create/Edit Item Screen

#### Заголовки полей
- `title` — "Title" / "Название"
- `details` — "Details" / "Детали"
- `title_for_the_item` — "Title for the Item" / "Название для записи"
- `details_for_the_item` — "Details for the Item" / "Подробное описание"

#### Цветовая метка
- `add_color_tag` — "Add color tag" / "Добавить цветовой тег"
- `color_tag` — "Color tag" / "Цветовой тег"

#### Опции отображения дней
- `display_format` — "Display format" / "Формат отображения"
- `days_only` — "Days only" / "Только дни"
- `months_and_days` — "Months and days" / "Месяцы и дни"
- `years_months_and_days` — "Years, months and days" / "Годы, месяцы и дни"

---

### Экран More Screen

#### Кнопки
- `send_feedback` — "Send feedback" / "Отправить обратную связь"
- `rate_the_app` — "Rate the app" / "Оценить приложение"
- `share_the_app` — "Share the app" / "Поделиться приложением"
- `github_page` — "GitHub page" / "Ссылка на GitHub"

#### Версия приложения
- `app_version` — "App version: %1$s" / "Версия приложения: %1$s"
  - Формат: строка с параметром для подстановки версии

---

### Экран Theme and Icon Screen

#### Заголовки секций
- `app_theme` — "App theme" / "Тема приложения"
- `app_icon` — "App Icon" / "Иконка приложения"

#### Опции темы
- `light` — "Light" / "Светлая"
- `dark` — "Dark" / "Тёмная"
- `system` — "System" / "Системная"

#### Иконки
- `primary_icon` — "Primary icon" / "Основная иконка"
- `variant` — "Variant %1$d" / "Вариант %1$d"
  - Формат: строка с параметром для номера варианта
- `selected` — "Selected" / "Выбрано"
- `not_selected` — "Not selected" / "Не выбрано"

---

### Экран App Data Screen

#### Кнопки действий
- `create_a_backup` — "Create a backup" / "Создать резервную копию"
- `restore_from_backup` — "Restore from backup" / "Восстановить из резервной копии"
- `delete_all_data` — "Delete all data" / "Удалить все данные"

#### Диалоги подтверждения
- `do_you_want_to_delete_all_data_permanently` — "Do you want to delete all data permanently?" / "Вы хотите навсегда удалить все данные?"

#### Сообщения результатов операций
- `backup_data_saved` — "Backup data saved" / "Резервная копия данных сохранена"
- `data_restored_from_backup` — "Data restored from backup" / "Данные восстановлены из резервной копии"
- `all_data_deleted` — "All data deleted" / "Все данные удалены"
- `unable_to_recover_data_from_the_selected_file` — "Unable to recover data from the selected file" / "Не удалось восстановить данные из выбранного файла"
- `error` — "Error" / "Ошибка"
- `event_deleted` — "Event deleted" / "Событие удалено"

---

### UI состояния и сообщения

##### Загрузка и навигация
- `loading` — "Loading" / "Загрузка..."
- `back` — "Back" / "Назад"

##### Поля формы
- `select_date` — "Select date" / "Выбрать дату"

##### Предпросмотр
- `preview` — "Preview" / "Предпросмотр"
- `elapsed` — "elapsed" / "прошло"
- `remaining` — "remaining" / "осталось"

##### Сообщения об ошибках
- `event_not_found` — "Event not found" / "Событие не найдено"
- `error_loading_event` — "Error loading event: %1$s" / "Ошибка загрузки события: %1$s"
- `error_creating_event` — "Error creating event: %1$s" / "Ошибка создания события: %1$s"
- `error_updating_event` — "Error updating event: %1$s" / "Ошибка обновления события: %1$s"
- `error_formatting` — "Formatting error" / "Ошибка форматирования"
- `error_calculating` — "Calculation error: %1$s" / "Ошибка при вычислении: %1$s"
- `error_formatting_details` — "Formatting error: %1$s" / "Ошибка форматирования: %1$s"

---

## План реализации

### Шаг 1: Создание файлов ресурсов

**Статус:** ✅ Выполнен

Созданы файлы `values/strings.xml` и `values-ru/strings.xml` со всеми необходимыми строками. Переводы идентичны iOS-версии.

---

### Шаг 2: Строки с параметрами

**Статус:** ✅ Выполнен

Реализованы строки с параметрами (`app_version`, `variant`) в формате Android (`%1$s`, `%1$d`).

---

### Шаг 3: Проверка соответствия iOS

**Статус:** ✅ Выполнен

Все строки из iOS-версии перенесены в Android, переводы идентичны.

---

### Шаг 4: Интеграция в код

**Статус:** ✅ Выполнен

Хардкод-строки в UI-компонентах заменены на `stringResource()`. Screen использует `titleResId` для локализации заголовков.

---

### Шаг 5: Замена хардкод-строк на строковые ресурсы

**Статус:** ✅ Выполнен (с временным решением для ViewModel'ов)

Добавлены новые строковые ресурсы (UI состояния, ошибки) и заменены оставшиеся хардкод-строки. В ViewModel'ах используется временное решение через `StubResourceProvider()`, требует рефакторинга в шаге 6.

---

### Шаг 6: Рефакторинг StubResourceProvider по best practice

**Статус:** ✅ Выполнен

#### Проблема

`StubResourceProvider` использовался напрямую в ViewModel'ах, нарушая DI и игнорируя локализацию системы.

#### Решение

Использовать `StubResourceProvider` только для тестов, а в продакшн-коде инжектировать `ResourceProviderImpl` через DI.

#### Выполненные задачи:

- ✅ Обновлен комментарий в `StubResourceProvider.kt` (только для тестов)
- ✅ Добавлен `ResourceProvider` в конструкторы `CreateEditScreenViewModel` и `DaysCalculatorViewModel`
- ✅ Обновлен `GetFormattedDaysForItemUseCase` для получения `ResourceProvider` через конструктор
- ✅ Добавлено свойство `resourceProvider` в `AppModule` с lazy-инициализацией
- ✅ Обновлены factory методы в `AppModule` и `FormatterModule` для передачи `ResourceProvider`
- ✅ Все использования `StubResourceProvider()` заменены на инжектированный `ResourceProvider`
- ✅ Обновлен `DaysCalculatorViewModelTest` для использования `StubResourceProvider` в тестах

#### Преимущества рефакторинга:

- ✅ Правильная локализация - сообщения отображаются на языке системы
- ✅ Соблюдение принципов DI - зависимости передаются через конструктор
- ✅ Тестируемость - `StubResourceProvider` остается для тестов
- ✅ Расширяемость - легко добавлять новые строковые ресурсы
- ✅ Единообразие - все ViewModel'ы используют один подход

#### Критерии готовности:

- ✅ Комментарий в `StubResourceProvider.kt` обновлен
- ✅ `ResourceProvider` добавлен в конструкторы ViewModel'ов
- ✅ `AppModule` обновлен для создания и передачи `ResourceProvider`
- ✅ Все использования `StubResourceProvider()` заменены
- ✅ Локализация работает корректно
- ✅ Тесты обновлены и успешно проходят

---

### Шаг 7: Локализация форматирования дней, дат и числительных

**Статус:** ❌ Не начат

#### Проблемы

В следующих местах приложения используется хардкод для форматирования на русском языке:

1. **Main Screen** - Список элементов
   - Справа от каждого элемента отображается количество дней на русском языке
   - Примеры: "31 день", "179 дней", "5 дней"
   - Причина: используется форматирование с суффиксами на русском языке

2. **Detail Screen** - Экран просмотра записи
   - Дата отображается на русском языке (например, "11 сентября 2025")
   - Количество дней отображается на русском (например, "112 дней")
   - Текст "прошло" под количеством дней отображается на русском языке

#### Задачи

##### 7.1 Анализ кода

1. Найти места, где используется хардкод для форматирования дней
2. Найти места, где используется хардкод для форматирования дат
3. Найти места, где используется хардкод для текстов "прошло"/"осталось"
4. Определить компоненты, которые нужно изменить:
   - DaysFormatter
   - DaysCalculatorViewModel
   - DetailScreen и его компоненты
   - ListItemView на MainScreen

##### 7.2 Создание строковых ресурсов

Добавить следующие ресурсы в `values/strings.xml` и `values-ru/strings.xml`:

**Числительные для дней:**
- `days_one` — "%1$d day" / "%1$d день"
- `days_few` — "%1$d days" / "%1$d дня"
- `days_many` — "%1$d days" / "%1$d дней"
- `days_other` — "%1$d days" / "%1$d дней"

**Или использовать plurals:**
```xml
<plurals name="days_count">
    <item quantity="one">%1$d day</item>
    <item quantity="other">%1$d days</item>
</plurals>
```
```xml
<plurals name="days_count">
    <item quantity="one">%1$d день</item>
    <item quantity="few">%1$d дня</item>
    <item quantity="many">%1$d дней</item>
    <item quantity="other">%1$d дней</item>
</plurals>
```

**Тексты статусов:**
- `elapsed` — "elapsed" / "прошло"
- `remaining` — "remaining" / "осталось"

**Примечание:** Ресурсы `elapsed` и `remaining` уже существуют в план-документе (строки 178-179), но не интегрированы в код.

##### 7.3 Рефакторинг форматирования дней

1. Обновить `DaysFormatter` для использования локализованных ресурсов
2. Заменить хардкод для суффиксов дней на `pluralStringResource()` или `quantityStringResource()`
3. Добавить поддержку множественного числа в зависимости от языка устройства

##### 7.4 Рефакторинг форматирования дат

1. Использовать `java.text.DateFormat` или `java.time.format.DateTimeFormatter` для локализованного форматирования дат
2. Проверить, что `SimpleDateFormat` или аналогичные классы используют локаль устройства
3. Обновить все места, где форматирование дат используется с хардкодом

##### 7.5 Интеграция локализованных ресурсов

1. Обновить `DaysCalculatorViewModel` для использования локализованных ресурсов через `ResourceProvider`
2. Обновить `ListItemView` на MainScreen для использования локализованных ресурсов
3. Обновить `DetailScreen` для использования локализованных ресурсов

##### 7.6 Тестирование

1. Протестировать на английском языке (locale=en)
   - Проверить количество дней (should show "1 day", "2 days", "5 days")
   - Проверить форматирование даты (например, "September 11, 2025")
   - Проверить текст статуса ("elapsed")

2. Протестировать на русском языке (locale=ru)
   - Проверить количество дней (should show "1 день", "2 дня", "5 дней")
   - Проверить форматирование даты (например, "11 сентября 2025")
   - Проверить текст статуса ("прошло")

#### Критерии готовности:
- ✅ Все места с хардкодом для форматирования найдены
- ✅ Созданы строковые ресурсы для дней (с plurals)
- ✅ Созданы/проверены строковые ресурсы для статусов (elapsed/remaining)
- ✅ `DaysFormatter` обновлен для использования локализованных ресурсов
- ✅ Форматирование дат использует локаль устройства
- ✅ Количество дней корректно отображается на обоих языках
- ✅ Даты корректно отображаются на обоих языках
- ✅ Тексты статусов корректно отображаются на обоих языках

---

### Шаг 8: Тестирование локализации

**Статус:** ❌ Не начат

#### Задачи:
1. Протестировать приложение на русском языке
2. Протестировать приложение на английском языке
3. Проверить, что все строки отображаются корректно
4. Проверить строки с параметрами
5. Проверить сообщения об ошибках с динамическими значениями
6. **Проверить локализацию форматирования дней, дат и числительных (Шаг 7)**

#### Критерии готовности:
- ✅ Все экраны протестированы на обоих языках
- ✅ Все строки отображаются корректно
- ✅ Строки с параметрами работают правильно
- ✅ Сообщения об ошибках локализованы и отображаются корректно
- ✅ Количество дней корректно локализовано
- ✅ Даты корректно локализованы
- ✅ Тексты статусов корректно локализованы

---

## Маппинг ключей iOS → Android

| iOS ключ | Android ключ | Описание |
|----------|--------------|----------|
| `.events` | `events` | Название вкладки "События" |
| `.more` | `more` | Название вкладки "Ещё" |
| `.addItem` | `add_item` | Кнопка "Добавить запись" |
| `.save` | `save` | Кнопка "Сохранить" |
| `.cancel` | `cancel` | Кнопка "Отмена" |
| `.close` | `close` | Кнопка "Закрыть" |
| `.edit` | `edit` | Кнопка "Изменить" |
| `.delete` | `delete` | Кнопка "Удалить" |
| `.title` | `title` | Заголовок "Название" |
| `.details` | `details` | Заголовок "Детали" |
| `.date` | `date` | Заголовок "Дата" |
| `.colorTag` | `color_tag` | Заголовок "Цветовой тег" |
| `.displayFormat` | `display_format` | Заголовок "Формат отображения" |
| `.today` | `today` | "Сегодня" |
| `.daysOnly` | `days_only` | "Только дни" |
| `.monthsAndDays` | `months_and_days` | "Месяцы и дни" |
| `.yearsMonthsAndDays` | `years_months_and_days` | "Годы, месяцы и дни" |
| `.whatShouldWeRemember` | `what_should_we_remember` | "Что нужно запомнить?" |
| `.createYourFirstItem` | `create_your_first_item` | "Сделайте вашу первую запись" |
| `.oldFirst` | `old_first` | "Сначала старые" |
| `.newFirst` | `new_first` | "Сначала новые" |
| `.sort` | `sort` | "Сортировка" |
| `.sortOrder` | `sort_order` | "Порядок сортировки" |
| `.appVersion` | `app_version` | "Версия приложения: %@" |
| `.sendFeedback` | `send_feedback` | "Отправить обратную связь" |
| `.rateTheApp` | `rate_the_app` | "Оценить приложение" |
| `.shareTheApp` | `share_the_app` | "Поделиться приложением" |
| `.gitHubPage` | `github_page` | "Ссылка на GitHub" |
| `.appTheme` | `app_theme` | "Тема приложения" |
| `.appIcon` | `app_icon` | "Иконка приложения" |
| `.light` | `light` | "Светлая" |
| `.dark` | `dark` | "Тёмная" |
| `.system` | `system` | "Системная" |
| `.createABackup` | `create_a_backup` | "Создать резервную копию" |
| `.restoreFromBackup` | `restore_from_backup` | "Восстановить из резервной копии" |
| `.deleteAllData` | `delete_all_data` | "Удалить все данные" |
| `.backupDataSaved` | `backup_data_saved` | "Резервная копия данных сохранена" |
| `.dataRestoredFromBackup` | `data_restored_from_backup` | "Данные восстановлены из резервной копии" |
| `.allDataDeleted` | `all_data_deleted` | "Все данные удалены" |
| `.unableToRecoverDataFromTheSelectedFile` | `unable_to_recover_data_from_the_selected_file` | "Не удалось восстановить данные из выбранного файла" |
| `.error` | `error` | "Ошибка" |
| `.done` | `done` | "Готово" |
| `.ok` | `ok` | "Ок" |
| — | `loading` | "Загрузка..." |
| — | `back` | "Назад" |
| — | `event_deleted` | "Событие удалено" |
| — | `select_date` | "Выбрать дату" |
| — | `preview` | "Предпросмотр" |
| — | `elapsed` | "прошло" |
| — | `remaining` | "осталось" |
| — | `event_not_found` | "Событие не найдено" |
| — | `error_loading_event` | "Ошибка загрузки события: %1$s" |
| — | `error_creating_event` | "Ошибка создания события: %1$s" |
| — | `error_updating_event` | "Ошибка обновления события: %1$s" |
| — | `error_formatting` | "Ошибка форматирования" |
| — | `error_calculating` | "Ошибка при вычислении: %1$s" |
| — | `error_formatting_details` | "Ошибка форматирования: %1$s" |
| — | `days_one` | "%1$d день" (для en: "%1$d day") |
| — | `days_few` | "%1$d дня" (для en: "%1$d days") |
| — | `days_many` | "%1$d дней" (для en: "%1$d days") |
| — | `days_other` | "%1$d дней" (для en: "%1$d days") |
| — | OR `days_count` (plurals) — множественное число для дней |

---

## Критерии завершения этапа

Этап локализации считается завершенным, когда:

- ✅ Все файлы ресурсов созданы (`values/strings.xml`, `values-ru/strings.xml`)
- ✅ Все строки из iOS-версии перенесены в Android
- ✅ Переводы идентичны iOS-версии
- ✅ Строки с параметрами реализованы корректно
- ✅ Все хардкод-строки заменены на ресурсы
- ✅ Screen использует titleResId для локализации вместо хардкод-строк
- ✅ Все сообщения об ошибках и UI-состояния локализованы
- ✅ Форматирование дней локализовано (используются plurals или соответствующие суффиксы)
- ✅ Форматирование дат использует локаль устройства
- ✅ Тексты статусов ("прошло"/"осталось") локализованы
- ✅ Локализация протестирована на обоих языках
- ✅ Переключение языка работает корректно

---

## Статус реализации

**✅ Локализация реализована и интегрирована в код**

**Выполненные шаги:**
- ✅ **Шаг 1**: Создание файлов ресурсов - ВЫПОЛНЕН
- ✅ **Шаг 2**: Строки с параметрами - ВЫПОЛНЕН
- ✅ **Шаг 3**: Проверка соответствия iOS - ВЫПОЛНЕН
- ✅ **Шаг 4**: Интеграция в код - ВЫПОЛНЕН
- ✅ **Шаг 5**: Замена хардкод-строк на строковые ресурсы - ВЫПОЛНЕН
- ✅ **Шаг 6**: Рефакторинг StubResourceProvider по best practice - ВЫПОЛНЕН
- ❌ **Шаг 7**: Локализация форматирования дней, дат и числительных - НЕ НАЧАТ
- ❌ **Шаг 8**: Тестирование локализации - НЕ НАЧАТ

**Текущее состояние:**

- ✅ Файлы ресурсов созданы, локализация в UI полностью интегрирована
- ✅ Локализация в ViewModel'ах реализована через DI с использованием `ResourceProvider`
- ✅ `StubResourceProvider` используется только в тестах
- ✅ Unit-тесты успешно проходят

**Проблемы:**
- ❌ Форматирование количества дней использует хардкод на русском языке
- ❌ Форматирование дат использует хардкод на русском языке
- ❌ Тексты "прошло"/"осталось" используют хардкод на русском языке
- ❌ Необходима реализация локализации числительных (plurals) для дней

**Примечание:** IDE может показывать ошибки "Unresolved reference" для новых ресурсов в R.java. Это временная проблема, которая исчезнет после сборки проекта (файл R.java будет перегенерирован).

---

## Примечания

1. **Источник истины**: iOS-приложение (`Localizable.xcstrings`) является источником истины для всех локализованных строк.

2. **Идентичность переводов**: Все переводы должны быть идентичны iOS-версии для обеспечения единообразия пользовательского опыта.

3. **Форматирование параметров**: Android использует формат `%1$s`, `%1$d` для параметров, в то время как iOS использует `%@`, `%lld`. При переносе необходимо адаптировать формат.

4. **Именование ключей**: Android использует snake_case для ключей строк, в то время как iOS использует camelCase. Ключи должны быть адаптированы, но значения должны оставаться идентичными.

5. **Тестирование**: Необходимо протестировать локализацию на обоих языках на всех экранах приложения.

