# Экран 5.1: More Screen (Ещё)

## Обзор

More Screen является экраном с дополнительными функциями и настройками приложения. Экран предоставляет доступ к настройкам темы и иконки, управлению данными, а также к внешним ссылкам и функциям обратной связи.

## Назначение

Экран с дополнительными функциями и настройками приложения, включая настройки темы и иконки, управление данными, отправку отзыва и ссылки на внешние ресурсы.

## Компоненты

1. **Заголовок экрана** — "Ещё" (используется из NavigationBar, не дублируется)

2. **Список кнопок настроек и действий**:

   - **Кнопка "Тема и иконка"** — Навигация к экрану ThemeIcon Screen (Screen 5.2)
   - **Кнопка "Данные приложения"** — Заглушка, выводит в консоль "TODO: открыть экран AppData Screen"
   - **Кнопка "Отправить отзыв"** — Открывает почтовый клиент/форму обратной связи
   - **Кнопка "Оценить приложение"** — Ссылка на страницу в RuStore для оценки
   - **Кнопка "Поделиться приложением"** — ShareSheet с ссылкой на приложение в RuStore
   - **Кнопка "Страница на GitHub"** — Ссылка на репозиторий приложения

3. **Текст версии приложения** (внизу экрана)

   - Формат: "Версия приложения: X.Y.Z" (локализован через stringResource)

## Навигация

- "Тема и иконка" → Экран 5.2 (ThemeIcon Screen) — ✅ Навигация реализована через navController.navigate(Screen.ThemeIcon.route)
- "Данные приложения" → Заглушка (выводит "TODO: открыть экран AppData Screen" в консоль)

**Примечание:** Реальная навигация к экрану 5.2 реализована. Кнопка "Данные приложения" является заглушкой для будущего функционала (экран 5.3).

## Зависимости от других этапов

- ✅ **Экран 1.1: Root Screen** — уже реализован, навигация к More Screen настроена
- ✅ **Экран 5.2: ThemeIcon Screen** — полностью реализован, навигация настроена
- ⚠️ **Экран 5.3: AppData Screen** — не требуется для этого этапа (кнопка-заглушка)

---

## Подробный план реализации по TDD

### Шаг 1: Структура и навигация

**Статус:** ✅ Выполнено

#### 1.1. Создание файла экрана

**Выполнено:**

- ✅ Файл `MoreScreen.kt` создан в `app/src/main/java/com/dayscounter/ui/screens/more/MoreScreen.kt`
- ✅ Компонент `moreScreen()` полностью реализован

---

#### 1.2. Настройка навигации

**Выполнено:**

- ✅ Навигация к экрану ThemeIcon Screen (Screen 5.2) реализована через navController.navigate(Screen.ThemeIcon.route)
- ✅ Кнопка-заглушка для "Данные приложения" реализована
- ✅ При нажатии выводится сообщение в Log.d("MoreScreen", "TODO: открыть экран AppData Screen")

---

### Шаг 2: Реализация UI компонентов

**Статус:** ✅ Выполнено

#### 2.1. Создание списка кнопок

**Выполнено:**

- ✅ Полноценный UI реализован в MoreScreen.kt с использованием verticalScroll
- ✅ Все 6 кнопок созданы: "Тема и иконка", "Данные приложения", "Отправить отзыв", "Оценить приложение", "Поделиться приложением", "Страница на GitHub"
- ✅ Версия приложения отображается внизу экрана
- ✅ Используются компоненты Material Design 3 (FilledTonalButton, TopAppBar)

---

### Шаг 3: Реализация функциональности

**Статус:** ✅ Выполнено

#### 3.0. Создание констант для внешних ссылок

**Выполнено:**

- ✅ Файл `AppConstants.kt` создан в `app/src/main/java/com/dayscounter/util/AppConstants.kt`
- ✅ Все константы определены: `APP_RATE_URL`, `APP_SHARE_URL`, `GITHUB_REPOSITORY_URL`

#### 3.1. Оценка приложения

**Выполнено:**

- ✅ Функция `rateApp(context: Context)` реализована
- ✅ Открытие страницы в RuStore через Intent.ACTION_VIEW
- ✅ Обработка ошибок через try-catch ActivityNotFoundException

#### 3.2. Шеринг приложения

**Выполнено:**

- ✅ Функция `shareApp(context: Context)` реализована
- ✅ ShareSheet через Intent.ACTION_SEND и Intent.createChooser
- ✅ Обработка ошибок через try-catch ActivityNotFoundException

#### 3.3. Открытие GitHub репозитория

**Выполнено:**

- ✅ Функция `openGitHub(context: Context)` реализована
- ✅ Открытие ссылки через Intent.ACTION_VIEW
- ✅ Обработка ошибок через try-catch ActivityNotFoundException

#### 3.4. Отправка отзыва

**Выполнено:**

- ✅ Функция `sendFeedback(context: Context)` реализована
- ✅ Отправка email через Intent.ACTION_SENDTO
- ✅ Динамическое получение названия приложения через PackageManager
- ✅ Формирование темы и тела письма с использованием локализованных ресурсов
- ✅ Включение информации о версии Android и версии приложения
- ✅ Обработка ошибок через try-catch ActivityNotFoundException

#### 3.5. Отображение версии приложения

**Выполнено:**

- ✅ Функция `appVersionText()` реализована
- ✅ Версия отображается внизу экрана из BuildConfig.VERSION_NAME
- ✅ Форматирование через stringResource(R.string.app_version, BuildConfig.VERSION_NAME)

---

### Шаг 4: Локализация

**Статус:** ✅ Выполнено

**Выполнено:**

- ✅ Все строковые ресурсы существуют в `values/strings.xml`, `values-ru/strings.xml`, `values-en/strings.xml`
- ✅ Используются ключи: `more`, `app_theme_and_icon`, `app_data`, `send_feedback`, `rate_the_app`, `share_the_app`, `github_page`, `app_version`, `feedback_subject`, `feedback_body`, `share_text`, `share_chooser_title`
- ✅ Локализация работает корректно

---

### Шаг 5: Финальное тестирование

**Статус:** ⚠️ Частично выполнено

**Выполнено:**

- ✅ UI тесты для отображения всех элементов созданы в `MoreScreenTest.kt`
- ✅ Проверяется отображение всех 6 кнопок на экране
- ✅ Проверяется отображение версии приложения

**Не выполнено (низкий приоритет):**

- ❌ UI тесты для проверки нажатий на кнопки
- ❌ UI тесты для проверки прокрутки в горизонтальной ориентации (не требуется для verticalScroll)
- ❌ Unit тесты для функций rateApp, shareApp, openGitHub, sendFeedback

---

## Реализация (детали)

### UI компоненты

- ✅ Вертикальная прокрутка (verticalScroll + rememberScrollState)
- ✅ 6 кнопок с текстовыми метками (FilledTonalButton)
- ✅ Визуальное разделение между кнопками (Spacer с dimensionResource)
- ✅ Версия приложения внизу экрана (Text с onSurface.copy(alpha = 0.6f))
- ✅ Material Design 3 (MaterialTheme, FilledTonalButton, TopAppBar)
- ✅ Scaffold для размещения TopAppBar и контента
- ✅ Preview компонента для предпросмотра

### Кнопки для настроек

В рамках этого этапа экран "Тема и иконка" уже полностью реализован и доступен через навигацию. Кнопка "Данные приложения" является заглушкой и выводит сообщение в Logcat при нажатии.

### Архитектура

- MoreScreen не требует ViewModel (простой экран без состояния)
- Обработка ошибок происходит в UI-слое через try-catch для Intent действий
- Навигация к ThemeIcon Screen реализована через navController.navigate(Screen.ThemeIcon.route)

---

## Тестирование

**Статус:** ⚠️ Частично выполнено

### UI-тесты (выполнено)

- ✅ Проверка отображения всех 6 кнопок на экране
- ✅ Проверка отображения версии приложения
- ✅ Тесты реализованы в `MoreScreenTest.kt`

### Не выполнено (низкий приоритет)

- ❌ UI тесты для проверки нажатий на кнопки
- ❌ UI тесты для проверки прокрутки в горизонтальной ориентации (не требуется для verticalScroll)
- ❌ Unit тесты для функций sendFeedback, rateApp, shareApp, openGitHub

---

## Текущее состояние реализации

**На основе анализа кода от января 2026 года:**

### Выполнено

- ✅ Файл `MoreScreen.kt` создан и функционален (`ui/screens/more/MoreScreen.kt`)
- ✅ Полноценная реализация UI с TopAppBar, 6 кнопками и отображением версии
- ✅ Все функции реализованы: rateApp, shareApp, openGitHub, sendFeedback
- ✅ Реальная навигация к экрану ThemeIcon Screen (Screen 5.2) реализована
- ✅ Кнопка-заглушка для "Данные приложения" реализована
- ✅ Вертикальная прокрутка через verticalScroll
- ✅ AppConstants.kt создан с константами APP_RATE_URL, APP_SHARE_URL, GITHUB_REPOSITORY_URL
- ✅ UI тесты для отображения элементов созданы в `androidTest/java/com/dayscounter/ui/screens/more/MoreScreenTest.kt`

### Не выполнено (низкий приоритет)

- ❌ UI тесты для проверки нажатий на кнопки
- ❌ Unit тесты для функций rateApp, shareApp, openGitHub, sendFeedback

---

## Примечания

1. **Внешние ссылки**: Все внешние ссылки обрабатывают случаи, когда соответствующие приложения не установлены или недоступны. Используется try-catch для Intent действий с логированием ошибок в Log.e("MoreScreen", "Сообщение об ошибке").

2. **Константы для ссылок**: Все внешние ссылки (RuStore, GitHub) хранятся в константах в файле `AppConstants.kt` (пакет `com/dayscounter/util/`). Это позволяет легко изменять ссылки в одном месте. Используются отдельные константы:
   - `APP_RATE_URL` - для оценки приложения в RuStore
   - `APP_SHARE_URL` - для шеринга приложения в RuStore
   - `GITHUB_REPOSITORY_URL` - для открытия GitHub

3. **Версия приложения**: Версия получается из BuildConfig.VERSION_NAME для автоматического обновления. Форматирование через stringResource(R.string.app_version, BuildConfig.VERSION_NAME). Отображается внизу экрана с уменьшенной прозрачностью (alpha = 0.6f).

4. **Тестирование**: Основные UI тесты реализованы для проверки отображения элементов на экране. Для полного покрытия кода тестами необходимы дополнительные тесты для проверки нажатий на кнопки и unit-тесты для бизнес-логики.

5. **Зависимости**: Реализация зависит от завершения Экрана 1.1 (Root Screen) - ✅ выполнено.

6. **Архитектура**: MoreScreen не требует ViewModel из-за отсутствия сложного состояния. Используется Stateless подход с передачей параметров. Обработка ошибок происходит в UI-слое через try-catch для Intent действий.

7. **Локализация**: Все строки уже существуют в проекте и используются в коде через stringResource. Поддерживаются русский и английский языки.

8. **Прокрутка списка**: Список кнопок реализован с использованием verticalScroll и rememberScrollState вместо LazyColumn. Это обеспечивает возможность вертикальной прокрутки, особенно важную для горизонтальной ориентации устройства.

9. **Кнопки для экранов настроек**: В рамках этого этапа реализована реальная навигация к экрану "Тема и иконка" (Screen 5.2). Кнопка "Данные приложения" (Screen 5.3) является заглушкой и:
   - Отображается как FilledTonalButton с текстом из stringResource
   - При нажатии выводит в Logcat сообщение "TODO: открыть экран AppData Screen"
   - Не вызывает крашей или ошибок
   - Реализована без реальной навигации

   Экран "Тема и иконка" полностью реализован в документе Screen_5.2_Theme_Icon_Screen.md. Экран "Данные приложения" будет реализован в документе Screen_5.3_App_Data_Screen.md.
