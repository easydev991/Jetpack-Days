# Анализ: Интеграция RuStore SDK для оценки приложения

## Версия документа: 1.0

## Дата создания: 14 января 2026

---

## 1. Обзор

Документ содержит анализ возможности интеграции RuStore SDK для функции оценки приложения в кнопке "Оценить приложение" на экране More Screen (Screen 5.1).

---

## 2. Текущая реализация

### 2.1. Текущая реализация

В текущей реализации функция оценки приложения открывает веб-страницу RuStore через Intent.ACTION_VIEW:

```kotlin
// app/src/main/java/com/dayscounter/util/AppConstants.kt
const val APP_RATE_URL = "https://apps.rustore.ru/app/com.dayscounter/reviews"

// app/src/main/java/com/dayscounter/ui/screen/MoreScreen.kt
fun rateApp(context: Context) {
    try {
        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(AppConstants.APP_RATE_URL))
        context.startActivity(intent)
    } catch (e: ActivityNotFoundException) {
        Log.e("MoreScreen", "Приложение для открытия ссылки не найдено", e)
    }
}
```

### 2.2. Преимущества текущей реализации

✅ Простая реализация без дополнительных зависимостей
✅ Работает для всех пользователей независимо от источника установки
✅ Не требует дополнительной настройки подписи
✅ Не требует наличия установленного RuStore на устройстве
✅ Работает для APK-установок

### 2.3. Недостатки текущей реализации

❌ Пользователь переходит в браузер/внешнее приложение
❌ Более сложный путь для оценки (несколько действий)
❌ Не использует нативный диалог оценки RuStore

---

## 3. RuStore SDK: Возможности и требования

### 3.1. Документация и ресурсы

- Документация SDK: <https://www.rustore.ru/help/sdk/reviews-ratings/kotlin-java/10-0-0>
- Пример использования: <https://gitflic.ru/project/rustore/rustore-sdk-review-example>

### 3.2. Основные методы SDK

```kotlin
// Создание менеджера
val reviewManager = RuStoreReviewManagerFactory.create(context)

// Подготовка данных для оценки (рекомендуется заранее)
private fun requestReviewFlow() {
    reviewManager.requestReviewFlow().addOnSuccessListener { reviewInfo ->
        this.reviewInfo = reviewInfo
    }
}

// Запуск диалога оценки
private fun launchReviewFlow() {
    val reviewInfo = reviewInfo
    if (reviewInfo != null) {
        reviewManager.launchReviewFlow(reviewInfo)
            .addOnSuccessListener {
                // Успешное отображение диалога
            }
            .addOnFailureListener {
                // Ошибка
            }
    }
}
```

### 3.3. Требования для работы RuStore SDK

#### Требования к устройству пользователя

✅ ОС Android версии 7.0 (API 24) или выше
✅ На устройстве пользователя установлена актуальная версия RuStore
✅ Пользователь авторизован в RuStore
✅ Приложение опубликовано в RuStore

#### Требования к разработчику/приложению

✅ ApplicationId, указанный в build.gradle, совпадает с applicationId APK-файла, опубликованного в консоли RuStore
✅ Подпись keystore должна совпадать с подписью опубликованного приложения

#### Важные ограничения

❌ Если пользователь не авторизован в RuStore — SDK не работает
❌ Если RuStore не установлен — SDK не работает
❌ Для отладки (debug build) нужно использовать ту же подпись, что и при публикации
❌ Приложение должно быть опубликовано в RuStore

### 3.4. Преимущества использования RuStore SDK

✅ Нативный диалог оценки прямо в приложении (без перехода в RuStore)
✅ Более удобный UX для пользователя
✅ Единый стандарт отзывов для RuStore
✅ Интеграция с системой отзывов RuStore

### 3.5. Недостатки использования RuStore SDK

❌ Дополнительная зависимость (~100-200 KB)
❌ Работает только если RuStore установлен и пользователь авторизован
❌ Работает только для приложений, установленных из RuStore (по требованиям)
❌ Требует публикации в RuStore перед началом тестирования
❌ Сложнее в реализации и тестировании
❌ Нужна настройка подписи для отладки

---

## 4. Определение источника установки приложения

### 4.1. Техническая возможность

Android предоставляет возможность определить источник установки через PackageManager:

```kotlin
val installerPackageName = context.packageManager.getInstallerPackageName(context.packageName)
```

### 4.2. Возможные значения

| Источник установки | Значение installerPackageName |
|--------------------|------------------------------|
| RuStore | `ru.vk.store` или подобное |
| Google Play | `com.android.vending` |
| APK (прямая установка) | `null` |
| Другие магазины (Huawei, Samsung и др.) | Соответствующие значения |

### 4.3. Ограничения определения источника

❌ Не всегда надежно для пользовательских сборок/случайных установок
❌ Производители устройств могут изменять значения
❌ Нельзя гарантировать, что все магазины приложений корректно устанавливают это значение

### 4.4. Рекомендуемая стратегия

```kotlin
fun isInstalledFromRuStore(context: Context): Boolean {
    val installer = context.packageManager.getInstallerPackageName(context.packageName)
    return installer == "ru.vk.store" || installer?.contains("rustore") == true
}
```

---

## 5. Возможные сценарии реализации

### 5.1. Сценарий А: Использование только RuStore SDK

**Логика:**

- Если приложение установлено из RuStore → использовать RuStore SDK
- Если не из RuStore → скрывать кнопку "Оценить приложение"

**Преимущества:**
✅ Чистая интеграция с RuStore для целевой аудитории
✅ Нет сложного ветвления логики
✅ Оптимизированный UX для RuStore пользователей

**Недостатки:**
❌ Пользователи, установившие APK, не смогут оценить приложение
❌ Пользователи из других магазинов не смогут оценить приложение
❌ Необходимо тщательно тестировать определение источника установки

**Сложность реализации:** ⭐⭐⭐ (средняя)

---

### 5.2. Сценарий Б: Гибридный подход (RuStore SDK + WebView)

**Логика:**

- Если приложение установлено из RuStore и RuStore SDK работает → использовать RuStore SDK
- Если RuStore SDK не работает (ошибка/нет RuStore/не авторизован) → открывать страницу RuStore через Intent

**Преимущества:**
✅ Максимальная доступность функции оценки
✅ Резервный вариант при ошибках SDK
✅ Все пользователи могут оставить отзыв
✅ Плавный переход между методами

**Недостатки:**
❌ Сложнее логика (два пути для оценки)
❌ Необходимо обрабатывать ошибки SDK
❌ Нужно тестировать оба сценария

**Сложность реализации:** ⭐⭐⭐⭐ (средне-высокая)

---

### 5.3. Сценарий В: Сохранение текущей реализации

**Логика:**

- Использовать только открытие страницы RuStore через Intent
- Не внедрять RuStore SDK

**Преимущества:**
✅ Простой и надежный подход
✅ Работает для всех пользователей
✅ Нет дополнительных зависимостей
✅ Нет требований к подписи и публикации

**Недостатки:**
❌ Не используется рекомендация RuStore
❌ Пользователь переходит в внешнее приложение
❌ Не использует нативные возможности RuStore SDK

**Сложность реализации:** ⭐ (минимальная - уже реализовано)

---

## 6. Оценка сложности интеграции RuStore SDK

### 6.1. Шаги интеграции

| Шаг | Задача | Сложность |
|-----|--------|-----------|
| 1 | Добавить зависимость RuStore SDK в build.gradle.kts | ⭐ (простой) |
| 2 | Создать сервис для работы с RuStore SDK | ⭐⭐ (средний) |
| 3 | Реализовать определение источника установки | ⭐⭐ (средний) |
| 4 | Интегрировать requestReviewFlow в MoreScreen | ⭐⭐ (средний) |
| 5 | Обработать ошибки SDK и добавить резервный вариант | ⭐⭐⭐ (средне-высокий) |
| 6 | Настроить подпись для тестирования | ⭐⭐⭐ (средне-высокий) |
| 7 | Написать unit тесты для новой логики | ⭐⭐⭐ (средне-высокий) |
| 8 | Протестировать на реальном устройстве с RuStore | ⭐⭐⭐⭐ (высокий) |

### 6.2. Общая оценка

**Сценарий А (только RuStore SDK):** ⭐⭐⭐ (средняя сложность, ~1-2 дня разработки)

**Сценарий Б (гибридный подход):** ⭐⭐⭐⭐ (средне-высокая сложность, ~2-3 дня разработки)

**Сценарий В (текущая реализация):** ⭐ (минимальная сложность, уже реализовано)

---

## 7. Рекомендации

### 7.1. Рекомендация для текущей фазы проекта

**Рекомендация:** Сохранить текущую реализацию (Сценарий В)

**Обоснование:**

1. **Приложение в разработке:**
   - Приложение ещё не опубликовано в RuStore
   - Сложно полноценно протестировать RuStore SDK без публикации
   - Необходимость настройки подписи для отладки добавляет сложность

2. **Офлайн приложение:**
   - Согласно архитектурным принципам, приложение работает полностью офлайн
   - RuStore SDK требует наличия RuStore на устройстве и авторизации пользователя
   - Это противоречит принципу независимости от внешних сервисов

3. **Простота и надёжность:**
   - Текущая реализация проста и работает для всех пользователей
   - Не создаёт проблем для APK-установок
   - Не требует дополнительных зависимостей

4. **UX-плюсы RuStore SDK минимальны:**
   - Переход на страницу оценки в RuStore не критичен
   - Пользователь уже привыкает к такой модели (аналогично Google Play)
   - Критичность использования нативного SDK для оценки невысока

### 7.2. Когда стоит внедрять RuStore SDK

Внедрение RuStore SDK целесообразно при выполнении следующих условий:

✅ Приложение официально опубликовано в RuStore
✅ Есть значительная доля пользователей, установивших приложение из RuStore
✅ Проведён анализ метрик: текущий конверсионный путь оценки неудобен для пользователей
✅ Есть ресурсы на тестирование и поддержку
✅ Настроена автоматизация с использованием одной и той же подписи для debug/release

### 7.3. Альтернатива: Внедрение в будущем

Если в будущем будет решено внедрить RuStore SDK:

1. **Начать со Сценария Б (гибридный подход)**
   - Максимальная доступность функции оценки
   - Резервный вариант при ошибках

2. **План внедрения:**
   - Шаг 1: Добавить зависимость RuStore SDK
   - Шаг 2: Создать сервис для работы с SDK
   - Шаг 3: Реализовать определение источника установки
   - Шаг 4: Добавить обработку ошибок и резервный вариант
   - Шаг 5: Написать тесты и протестировать

3. **Метрики для оценки эффективности:**
   - Количество оценок до и после внедрения SDK
   - Конверсия с открытия страницы RuStore до оценки
   - Отзывы пользователей о процессе оценки

---

## 8. Заключение

### 8.1. Ответы на исходные вопросы

**Вопрос:** Можно ли у нас реализовать вызов RuStore SDK при нажатии на кнопку "Оценить приложение"?

**Ответ:** Да, это возможно технически. RuStore SDK предоставляет готовый API для отображения диалога оценки.

**Вопрос:** Насколько это будет сложно?

**Ответ:**

- Сценарий А (только RuStore SDK): ⭐⭐⭐ (средняя сложность, ~1-2 дня)
- Сценарий Б (гибридный подход): ⭐⭐⭐⭐ (средне-высокая сложность, ~2-3 дня)

Основная сложность — необходимость публикации приложения в RuStore, настройки подписи и обработки ошибок.

**Вопрос:** Можно ли определять при нажатии на кнопку, откуда было установлено приложение?

**Ответ:** Да, это возможно через PackageManager.getInstallerPackageName(). Значение для RuStore — `ru.vk.store` или содержит `rustore`. Однако этот метод не всегда 100% надежен и требует тестирования.

### 8.2. Итоговая рекомендация

Для текущей фазы проекта (приложение в разработке, ещё не опубликовано) рекомендуется:

✅ **Сохранить текущую реализацию с открытием страницы RuStore через Intent**

Это простое, надежное и универсальное решение, которое работает для всех пользователей и не создаёт лишних зависимостей.

⏳ **Отложить внедрение RuStore SDK до официальной публикации приложения в RuStore**

Внедрение SDK можно рассмотреть после публикации, если анализ метрик покажет необходимость улучшения UX для оценки приложения.

---

## 9. Дополнительные ресурсы

- RuStore SDK документация: <https://www.rustore.ru/help/sdk/reviews-ratings/kotlin-java/10-0-0>
- Пример внедрения SDK: <https://gitflic.ru/project/rustore/rustore-sdk-review-example>
- Текущая реализация оценки приложения: `app/src/main/java/com/dayscounter/ui/screen/MoreScreen.kt`
- Константы ссылок: `app/src/main/java/com/dayscounter/util/AppConstants.kt`

---

## 10. История изменений

| Версия | Дата | Описание изменений |
|--------|------|-------------------|
| 1.0 | 14.01.2026 | Первая версия документа с анализом возможностей интеграции RuStore SDK |
