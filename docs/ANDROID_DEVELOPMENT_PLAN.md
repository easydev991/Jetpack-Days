# План разработки приложения для Android (Days Counter)

## Обзор приложения
Приложение для отслеживания и подсчёта дней, прошедших с момента важных
событий. Пользователь может создавать записи с датами, просматривать,
редактировать и удалять их, а также управлять резервными копиями данных.

**ВАЖНО:** Приложение работает полностью в автономном режиме (офлайн) без
сетевых функций. Единственное взаимодействие с внешними файлами - экспорт
резервной копии и импорт резервной копии по аналогии с iOS-приложением.
Модель резервной копии должна быть совместима между iOS и Android-приложениями.

## Современный стек технологий (2025)

### Основные зависимости
- **Jetpack Compose**: Современный инструментарий для создания нативного Android UI
- **Navigation Compose**: Для навигации между экранами
- **ViewModel**: Для управления данными, связанными с UI
- **Room**: Для локальных операций с базой данных
- **DataStore**: Для простого хранения данных
- **Coroutines**: Для асинхронных операций
- **Hilt**: Для внедрения зависимостей
- **JUnit 5**: Для модульного тестирования
- **MockK**: Для мокирования в тестах
- **Espresso**: Для UI тестирования

### Инструменты разработки
- **AGP (Android Gradle Plugin)**: 8.13.2
- **Kotlin**: 2.1.20
- **Compile SDK**: 35
- **Target SDK**: 35
- **Min SDK**: 26
- **KSP (Kotlin Symbol Processing)**: 2.1.20-1.0.28

### Архитектурные принципы
- **MVVM Pattern**: Model-View-ViewModel архитектура
- **Clean Architecture**: Четкое разделение на слои (Presentation, Domain, Data)
- **TDD (Test Driven Development)**: Разработка через тестирование
- **Jetpack Compose**: Для построения современного UI
- **Repository Pattern**: Для абстракции источников данных

---

## Этап 1: Основная навигация

### Экран 1.1: Root Screen (Корневой экран с TabBar)

**Назначение:** Основной экран приложения с нижней навигацией

**Вкладки:**

- **Вкладка "События"** — главный список записей
- **Вкладка "Ещё"** — дополнительные функции и настройки

**Навигация:**

- Переключение между вкладками через Bottom Navigation Bar
- Активация вкладки "События" по умолчанию при запуске

**Технологии:**
- Использовать Navigation Compose для управления навигацией
- Создать sealed class для определения вкладок
- Реализовать BottomNavigation с двумя пунктами
- Управление состоянием вкладок с помощью ViewModel или локального состояния
- Обработка событий переключения вкладок

---

## Этап 2: Главный экран (Список событий)

### Экран 2.1: Main Screen

**Назначение:** Отображение списка всех записей о событиях

**Компоненты:**
1. **Заголовок экрана** — "События"
2. **Кнопка сортировки** (если более 1 записи)
   - Позиция: слева на Toolbar
   - Опции: "По возрастанию" / "По убыванию"
   - Сортировка по дате события
3. **Поле поиска**
   - Позиция: на Toolbar
   - Поиск по названию и описанию записи
   - Фильтрация списка в реальном времени
4. **Кнопка добавления записи**
   - Позиция: справа на Toolbar
   - Иконка: "+"
   - Открывает экран создания новой записи
5. **Список записей** (ListView/RecyclerView)
   - Карточка каждой записи содержит:
     - Название события
     - Количество дней с момента события (отформатированное)
     - Дата события
     - Цветовая метка (если задана)
   - Клик по карточке — переход к деталям записи
6. **Пустое состояние** (если нет записей)
   - Иконка: "tray.fill"
   - Заголовок: "Что запомнить?"
   - Описание: "Создайте первую запись"
   - Кнопка: "Добавить запись"

**Взаимодействия:**
- Долгое нажатие на запись — открытие контекстного меню с опциями: "Редактировать", "Удалить"
- Свайп по записи влево — удаление (опционально)
- Свайп по записи вправо — редактирование (опционально)

**Навигация:**
- Клик на запись → Screen 3.1 (Item Screen)
- Кнопка "+" → Screen 4.1 (Create Item Screen)
- Из контекстного меню: "Редактировать" → Screen 4.1 (Edit Item Screen)

---

## Этап 3: Детали записи

### Экран 3.1: Item Screen (Просмотр записи)

**Назначение:** Просмотр полной информации о событии и количества прошедших дней

**Компоненты:**
1. **Заголовок экрана** — количество дней с момента события (вычисляется динамически)
2. **Секция "Название"**
   - Заголовок: "Название"
   - Текст: название события
3. **Секция "Описание"** (если есть текст)
   - Заголовок: "Описание"
   - Текст: описание события
4. **Секция "Дата события"**
   - Заголовок: "Дата"
   - Текст: выбранная дата события (формат даты)
5. **Цветовая метка** (если задана)
   - Отображается цветом
   - Не редактируемый ColorPicker
6. **Опция отображения** (показывает текущий формат)
   - Текст: "Только дни", "Дни и месяцы", или "Годы, месяцы и дни"
   - Не редактируемый

**Кнопки на Toolbar:**
- **Кнопка редактирования** (справа на Toolbar)
    - Иконка: "карандаш"
    - Переключает экран в режим редактирования (in-place или переход)
- **Кнопка назад** (слева на Toolbar)
    - Возврат к списку записей

**Навигация:**
- Кнопка "Назад" → Экран 2.1 (Main Screen)
- Кнопка "Редактировать" → Экран 4.1 (Edit Item Screen)

---

## Этап 4: Создание и редактирование записей

### Экран 4.1: Create/Edit Item Screen

**Назначение:** Создание новой записи или редактирование существующей

**Компоненты:**
1. **Заголовок экрана**
   - Для создания: "Новая запись"
   - Для редактирования: "Редактировать"
2. **Поле ввода "Название"**
   - Заголовок: "Название"
   - Placeholder: "Название для записи"
   - Обязательное поле
   - Автофокус при открытии экрана
3. **Поле ввода "Описание"**
   - Заголовок: "Описание"
   - Placeholder: "Описание для записи"
   - Многострочное текстовое поле
   - Необязательное поле
4. **Выбор даты**
   - Заголовок: "Дата события"
   - DatePicker с выбором даты (и времени, если нужно)
   - По умолчанию: текущая дата
5. **Цветовая метка**
   - Toggle: "Добавить цветовую метку"
   - При включении — показывается ColorPicker
   - При выключении — скрывается ColorPicker
   - По умолчанию: выключено
6. **Опция отображения дней**
   - Заголовок: "Формат отображения"
   - Опции (Single Choice):
      - "Только дни"
      - "Дни и месяцы"
      - "Годы, месяцы и дни"
   - По умолчанию: "Только дни"

**Кнопки на Toolbar:**
- **Кнопка "Отмена" / "Закрыть"**
   - Для создания: "Закрыть" (возвращает к списку)
   - Для редактирования: "Отмена" (возвращает к просмотру записи)
   - Позиция: слева
- **Кнопка "Сохранить"**
   - Позиция: справа
   - Активна только если название не пустое и при редактировании
     есть изменения

**Валидация:**
- Название не может быть пустым
- При редактировании кнопка "Сохранить" активна только если данные изменились

**Навигация:**
- Кнопка "Отмена/Закрыть" → возврат к предыдущему экрану
- Кнопка "Сохранить" → сохранение данных и возврат к предыдущему экрану

---

## Этап 5: Дополнительные функции

### Экран 5.1: More Screen (Ещё)

**Назначение:** Экран с дополнительными функциями и настройками приложения

**Компоненты:**

1. **Заголовок экрана** — "Ещё"
2. **Кнопка "Тема и иконка"**
   - Переход к экрану Screen 5.2
3. **Кнопка "Данные приложения"**
   - Переход к экрану Screen 5.3
4. **Кнопка "Отправить отзыв"**
   - Открывает почтовый клиент/форму обратной связи
5. **Кнопка "Оценить приложение"**
   - Ссылка на страницу в Google Play для оценки
6. **Кнопка "Поделиться приложением"**
   - ShareSheet с ссылкой на приложение в Google Play
7. **Кнопка "Страница на GitHub"**
   - Ссылка на репозиторий приложения
8. **Текст версии приложения** (внизу экрана)
   - Формат: "Версия X.Y.Z"

**Навигация:**
- "Тема и иконка" → Screen 5.2
- "Данные приложения" → Screen 5.3

---

### Экран 5.2: Theme and Icon Screen

**Назначение:** Настройка темы приложения и выбор иконки

**Компоненты:**
1. **Заголовок экрана** — "Тема и иконка"
2. **Секция "Тема приложения"**
   - Заголовок: "Тема"
   - Выбор из опций:
     - "Светлая"
     - "Тёмная"
     - "Системная"
   - Радиокнопки или Dropdown
3. **Секция "Иконка приложения"**
   - Заголовок: "Иконка"
   - Сетка с иконками (GridView)
   - Каждая иконка:
      - Превью иконки (65x65dp)
      - Галочка на выбранной иконке
   - При клике — установка иконки (если поддерживается системой)

**Навигация:**
- Кнопка "Назад" → Screen 5.1 (More Screen)

---

### Экран 5.3: App Data Screen

**Назначение:** Управление данными приложения

**Компоненты:**
1. **Заголовок экрана** — "Данные приложения"
2. **Кнопка "Создать резервную копию"** (если есть записи)
   - Открывает FilePicker для сохранения JSON-файла
   - Имя файла по умолчанию: "Days backup"
   - Формат: JSON
3. **Кнопка "Восстановить из резервной копии"**
   - Открывает FilePicker для выбора JSON-файла
   - Загружает записи из файла
   - Добавляет только новые записи (не дублирует существующие)
4. **Кнопка "Удалить все данные"** (если есть записи)
   - Стиль: деструктивный (красный цвет)
   - Требует подтверждения действия
   - Удаляет все записи из базы данных

**Диалоги подтверждения:**
- **Диалог удаления данных**
    - Заголовок: "Удалить все данные?"
    - Сообщение: "Вы хотите удалить все данные безвозвратно?"
    - Кнопки: "Удалить" (деструктивная), "Отмена"

**Диалоги результатов:**
- **Успешное создание бэкапа**
    - Заголовок: "Готово"
    - Сообщение: "Резервная копия сохранена"
- **Успешное восстановление**
    - Заголовок: "Готово"
    - Сообщение: "Данные восстановлены из резервной копии"
- **Успешное удаление**
    - Заголовок: "Готово"
    - Сообщение: "Все данные удалены"
- **Ошибка восстановления**
    - Заголовок: "Ошибка"
    - Сообщение: "Не удалось восстановить данные из выбранного файла"

**Навигация:**
- Кнопка "Назад" → Screen 5.1 (More Screen)

---

## Этап 6: Форматирование количества дней

### Функция вычисления дней

**Логика:**
1. Получить дату события (timestamp)
2. Получить текущую дату
3. Вычислить разницу в годах, месяцах и днях
4. Отформатировать результат в соответствии с выбранной опцией отображения

**Опции отображения:**

1. **Только дни (Day)**
    - Формат: "X дней"
    - Единицы измерения: только дни
    - Примеры: "Сегодня", "5 дней", "30 дней", "365 дней"

2. **Дни и месяцы (Month + Day)**
    - Формат: "X месяцев Y дней"
    - Если есть оба значения → краткий формат: "2 мес. 5 дн."
    - Если только одно значение → полный формат: "2 месяца" или "5 дней"
    - Примеры: "Сегодня", "1 месяц", "2 месяца 5 дней", "11 месяцев 30 дней"

3. **Годы, месяцы и дни (Year + Month + Day)**
    - Формат: "X лет Y месяцев Z дней"
    - Если есть все три значения → сокращённый формат: "1 г. 2 мес. 5 дн."
    - Если есть два значения → краткий формат: "2 мес. 5 дн."
    - Если только одно значение → полный формат: "1 год" или "2 месяца" или "5 дней"
    - Примеры: "Сегодня", "1 год", "1 год 2 месяца", "1 год 2 месяца 5 дней"

**Специальные случаи:**
- Если разница = 0 дней → показать "Сегодня"
- Множественное число: учитывать языковые особенности (день/дня/дней)

---

## Этап 7: Модель данных

### Сущность: Item (Запись)

**Поля:**
- `id`: Long — уникальный идентификатор
- `title`: String — название события (обязательное)
- `details`: String — описание события (необязательное)
- `timestamp`: Long — дата события в миллисекундах
- `colorTag`: Int? — ARGB-цвет для цветовой метки (необязательное)
- `displayOption`: Enum — опция отображения дней
  - `DAY`
  - `MONTH_DAY`
  - `YEAR_MONTH_DAY`
  - По умолчанию: `DAY`

**Методы:**
- `makeDaysCount(currentDate: Long): String` — вычисляет и форматирует количество дней

---

## Этап 8: Резервное копирование

### Формат резервной копии (JSON)

**ВАЖНО:** Структура файла резервной копии должна быть совместима с iOS-приложением.

**Структура:**
```json
[
  {
    "title": "Название события",
    "details": "Описание события",
    "timestamp": 1234567890000,
    "colorTag": "#FFFF00",
    "displayOption": "day"
  }
]
```

**Логика создания бэкапа:**
1. Получить все записи из базы данных
2. Сериализовать в JSON в формате, совместимом с iOS-приложением
3. Предложить пользователю сохранить файл

**Логика восстановления:**
1. Выбрать JSON-файл (в формате, совместимом с iOS-приложением)
2. Десериализовать из JSON
3. Сравнить с существующими записями
4. Добавить только новые записи (по уникальному ключу или полному совпадению)
5. Сохранить в базу данных

---

## Этап 9: Настройки приложения

### Сущность: AppSettings

**Параметры:**
- `appTheme`: Enum — тема приложения
  - `LIGHT`
  - `DARK`
  - `SYSTEM`
  - По умолчанию: `SYSTEM`
- `appIcon`: Enum — выбранная иконка (если поддерживается системой)
- `appVersion`: String — версия приложения

---

## Этап 10: Локализация

**Поддерживаемые языки:**
- Русский (ru)
- Английский (en)

**Строки для локализации:**
- Заголовки экранов
- Кнопки и действия
- Сообщения об ошибках
- Диалоги подтверждения
- Форматы отображения дней
- Опции сортировки

---

## Резюме навигации

```
Root Screen (TabBar)
│
├── Tab "События"
│   └── Main Screen (список записей)
│       ├── Клик на запись → Item Screen (детали)
│       │   └── Кнопка "Редактировать" → Edit Item Screen
│       ├── Кнопка "+" → Create Item Screen
│       └── Контекстное меню → Edit Item Screen
│
└── Tab "Ещё"
    └── More Screen
        ├── Тема и иконка → Theme and Icon Screen
        └── Данные приложения → App Data Screen
```

---

## Порядок разработки (рекомендуемый)

1. **Этап 1**: Создать проект и базовую структуру навигации (TabBar)
2. **Этап 2**: Реализовать главный экран с пустым состоянием
3. **Этап 4**: Реализовать экран создания записей
4. **Этап 2 (продолжение)**: Добавить отображение списка записей
5. **Этап 3**: Реализовать экран деталей записи
6. **Этап 4 (продолжение)**: Реализовать экран редактирования записей
7. **Этап 2 (продолжение)**: Добавить поиск и сортировку
8. **Этап 6**: Реализовать вычисление и форматирование дней
9. **Этап 5**: Реализовать экран "Ещё" и его подсекции
10. **Этап 8**: Реализовать резервное копирование и восстановление
11. **Этап 9**: Реализовать настройки приложения (тема)
12. **Этап 10**: Добавить локализацию
13. **Тестирование и полировка UI**
