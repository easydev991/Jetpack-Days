package com.dayscounter.domain.usecase

import com.dayscounter.data.formatter.DaysFormatter
import com.dayscounter.data.formatter.ResourceProvider
import com.dayscounter.domain.model.DaysDifference
import com.dayscounter.domain.model.DisplayOption
import com.dayscounter.domain.model.TimePeriod
import io.mockk.every
import io.mockk.mockk
import org.junit.Test
import kotlin.test.assertEquals

/**
 * Тесты для [FormatDaysTextUseCase].
 */
class FormatDaysTextUseCaseTest {
    private val daysFormatter = mockk<DaysFormatter>()
    private val resourceProvider = mockk<ResourceProvider>()
    private val useCase = FormatDaysTextUseCase(daysFormatter)

    @Test
    fun `format when Today then returns Сегодня (ru)`() {
        // Given
        val difference = DaysDifference.Today(timestamp = System.currentTimeMillis())
        every { resourceProvider.getString(R.string.today) } returns "Сегодня"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("Сегодня", result, "Ожидалась строка 'Сегодня'")
    }

    @Test
    fun `format when Today then returns Today (en)`() {
        // Given
        val difference = DaysDifference.Today(timestamp = System.currentTimeMillis())
        every { resourceProvider.getString(R.string.today) } returns "Today"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("Today", result, "Ожидалась строка 'Today'")
    }

    @Test
    fun `format when DAY option with 1 day then returns 1 день (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 1)
        val difference = DaysDifference.Calculated(period, 1, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.DAY, resourceProvider)
        } returns "1 день"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("1 день", result, "Ожидалась строка '1 день'")
    }

    @Test
    fun `format when DAY option with 5 days then returns 5 дней (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 5)
        val difference = DaysDifference.Calculated(period, 5, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.DAY, resourceProvider)
        } returns "5 дней"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("5 дней", result, "Ожидалась строка '5 дней'")
    }

    @Test
    fun `format when DAY option with 365 days then returns 365 дней (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 365)
        val difference = DaysDifference.Calculated(period, 365, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.DAY, resourceProvider)
        } returns "365 дней"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("365 дней", result, "Ожидалась строка '365 дней'")
    }

    @Test
    fun `format when DAY option with 1 day then returns 1 day (en)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 1)
        val difference = DaysDifference.Calculated(period, 1, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.DAY, resourceProvider)
        } returns "1 day"

        // When
        val result = useCase(difference, DisplayOption.DAY, resourceProvider)

        // Then
        assertEquals("1 day", result, "Ожидалась строка '1 day'")
    }

    @Test
    fun `format when MONTH_DAY option with 1 month 0 days then returns 1 месяц (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 1, days = 0)
        val difference = DaysDifference.Calculated(period, 30, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.MONTH_DAY, resourceProvider)
        } returns "1 месяц"

        // When
        val result = useCase(difference, DisplayOption.MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 месяц", result, "Ожидалась строка '1 месяц'")
    }

    @Test
    fun `format when MONTH_DAY option with 2 months 5 days then returns abbreviated format (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 2, days = 5)
        val difference = DaysDifference.Calculated(period, 65, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.MONTH_DAY, resourceProvider)
        } returns "2 мес. 5 дн."

        // When
        val result = useCase(difference, DisplayOption.MONTH_DAY, resourceProvider)

        // Then
        assertEquals("2 мес. 5 дн.", result, "Ожидалась строка '2 мес. 5 дн.'")
    }

    @Test
    fun `format when MONTH_DAY option with 11 months 30 days then returns abbreviated format (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 11, days = 30)
        val difference = DaysDifference.Calculated(period, 365, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.MONTH_DAY, resourceProvider)
        } returns "11 мес. 30 дн."

        // When
        val result = useCase(difference, DisplayOption.MONTH_DAY, resourceProvider)

        // Then
        assertEquals("11 мес. 30 дн.", result, "Ожидалась строка '11 мес. 30 дн.'")
    }

    @Test
    fun `format when MONTH_DAY option with 0 months 5 days then returns 5 дней (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 5)
        val difference = DaysDifference.Calculated(period, 5, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.MONTH_DAY, resourceProvider)
        } returns "5 дней"

        // When
        val result = useCase(difference, DisplayOption.MONTH_DAY, resourceProvider)

        // Then
        assertEquals("5 дней", result, "Ожидалась строка '5 дней'")
    }

    @Test
    fun `format when MONTH_DAY option with 1 month then returns 1 month (en)`() {
        // Given
        val period = TimePeriod(years = 0, months = 1, days = 0)
        val difference = DaysDifference.Calculated(period, 30, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.MONTH_DAY, resourceProvider)
        } returns "1 month"

        // When
        val result = useCase(difference, DisplayOption.MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 month", result, "Ожидалась строка '1 month'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 1 year 0 months 0 days then returns 1 год (ru)`() {
        // Given
        val period = TimePeriod(years = 1, months = 0, days = 0)
        val difference = DaysDifference.Calculated(period, 365, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "1 год"

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 год", result, "Ожидалась строка '1 год'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 1 year 2 months 0 days then returns 1 год 2 месяца (ru)`() {
        // Given
        val period = TimePeriod(years = 1, months = 2, days = 0)
        val difference = DaysDifference.Calculated(period, 425, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "1 год 2 месяца"

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 год 2 месяца", result, "Ожидалась строка '1 год 2 месяца'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 1 year 2 months 5 days then returns abbreviated format (ru)`() {
        // Given
        val period = TimePeriod(years = 1, months = 2, days = 5)
        val difference = DaysDifference.Calculated(period, 430, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "1 г. 2 мес. 5 дн."

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 г. 2 мес. 5 дн.", result, "Ожидалась строка '1 г. 2 мес. 5 дн.'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 0 years 2 months 5 days then returns abbreviated format (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 2, days = 5)
        val difference = DaysDifference.Calculated(period, 65, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "2 мес. 5 дн."

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("2 мес. 5 дн.", result, "Ожидалась строка '2 мес. 5 дн.'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 0 years 0 months 5 days then returns 5 дней (ru)`() {
        // Given
        val period = TimePeriod(years = 0, months = 0, days = 5)
        val difference = DaysDifference.Calculated(period, 5, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "5 дней"

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("5 дней", result, "Ожидалась строка '5 дней'")
    }

    @Test
    fun `format when YEAR_MONTH_DAY option with 1 year then returns 1 year (en)`() {
        // Given
        val period = TimePeriod(years = 1, months = 0, days = 0)
        val difference = DaysDifference.Calculated(period, 365, System.currentTimeMillis())
        every {
            daysFormatter.formatComposite(period, DisplayOption.YEAR_MONTH_DAY, resourceProvider)
        } returns "1 year"

        // When
        val result = useCase(difference, DisplayOption.YEAR_MONTH_DAY, resourceProvider)

        // Then
        assertEquals("1 year", result, "Ожидалась строка '1 year'")
    }
}
